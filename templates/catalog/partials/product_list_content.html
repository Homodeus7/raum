<div class="min-h-screen bg-raum-black" x-data="{ filterOpen: false }" x-effect="document.body.style.overflow = filterOpen ? 'hidden' : 'auto'">
  <!-- Page Header -->
  <div class="px-4 md:px-8 py-8 md:py-12 border-b border-raum-border">
    <h1 class="text-xl md:text-2xl uppercase tracking-wide">
      {% if selected_category %}{{ selected_category.name }}{% else %}All Eyewear{% endif %}
    </h1>
  </div>

  <!-- Filter Bar -->
  <div class="sticky top-14 z-30 bg-raum-black border-b border-raum-border flex justify-between items-center px-4 md:px-8 py-3 text-[10px] md:text-xs uppercase tracking-widest text-neutral-400">
    <div class="flex flex-wrap gap-2 md:gap-4 overflow-x-auto no-scrollbar">
      <span
        hx-get="{% url 'catalog:product_list' %}"
        hx-target="#main-content"
        hx-swap="innerHTML show:top"
        hx-push-url="true"
        class="{% if not selected_category %}text-white border-b border-white{% else %}hover:text-white{% endif %} cursor-pointer transition-colors">
        All
      </span>
      {% for category in categories %}
      <span
        hx-get="{% url 'catalog:product_list' %}?category={{ category.slug }}"
        hx-target="#main-content"
        hx-swap="innerHTML show:top"
        hx-push-url="true"
        class="{% if selected_category.id == category.id %}text-white border-b border-white{% else %}hover:text-white{% endif %} cursor-pointer transition-colors">
        {{ category.name }}
      </span>
      {% endfor %}
    </div>
    <div @click="filterOpen = true" class="flex items-center cursor-pointer hover:text-white pl-4 bg-raum-black">
      <span>Filter & Sort</span>
      <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
    </div>
  </div>

  <!-- Filter Modal -->
  <div
    x-show="filterOpen"
    x-transition:enter="transition ease-out duration-200"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition ease-in duration-150"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    @click.self="filterOpen = false"
    class="fixed inset-0 z-50 flex items-start justify-end bg-black/60 backdrop-blur-sm"
    style="display: none;">

    <div
      x-show="filterOpen"
      x-transition:enter="transition ease-out duration-300 transform"
      x-transition:enter-start="translate-x-full"
      x-transition:enter-end="translate-x-0"
      x-transition:leave="transition ease-in duration-200 transform"
      x-transition:leave-start="translate-x-0"
      x-transition:leave-end="translate-x-full"
      @click.stop
      class="w-full md:w-96 h-full bg-raum-black border-l border-raum-border overflow-y-auto">

      <!-- Filter Header -->
      <div class="sticky top-0 bg-raum-black border-b border-raum-border px-6 py-4 flex justify-between items-center">
        <h2 class="text-sm uppercase tracking-widest">Filter & Sort</h2>
        <button @click="filterOpen = false" class="text-neutral-400 hover:text-white transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
      </div>

      <!-- Filter Form -->
      <form
        hx-get="{% url 'catalog:product_list' %}"
        hx-target="#product-grid"
        hx-swap="outerHTML"
        hx-push-url="true"
        hx-trigger="change, submit"
        @submit.prevent
        class="p-6 space-y-6">

        {% if selected_category %}
        <input type="hidden" name="category" value="{{ selected_category.slug }}">
        {% endif %}

        <!-- Sort -->
        <div class="border-b border-raum-border pb-6">
          <label class="block text-[10px] uppercase tracking-widest text-neutral-400 mb-3">Sort By</label>
          <select name="sort" class="w-full bg-neutral-900 border border-raum-border text-sm px-3 py-2 text-white focus:outline-none focus:border-white transition-colors">
            <option value="">Default</option>
            <option value="price_asc" {% if request.GET.sort == 'price_asc' %}selected{% endif %}>Price: Low to High</option>
            <option value="price_desc" {% if request.GET.sort == 'price_desc' %}selected{% endif %}>Price: High to Low</option>
            <option value="name_asc" {% if request.GET.sort == 'name_asc' %}selected{% endif %}>Name: A to Z</option>
            <option value="name_desc" {% if request.GET.sort == 'name_desc' %}selected{% endif %}>Name: Z to A</option>
            <option value="newest" {% if request.GET.sort == 'newest' %}selected{% endif %}>Newest First</option>
          </select>
        </div>

        <!-- Price Range -->
        <div class="border-b border-raum-border pb-6">
          <label class="block text-[10px] uppercase tracking-widest text-neutral-400 mb-3">Price Range</label>
          <div class="flex gap-3 items-center">
            <input type="number" name="price_min" placeholder="Min" value="{{ request.GET.price_min }}" class="w-full bg-neutral-900 border border-raum-border text-sm px-3 py-2 text-white focus:outline-none focus:border-white transition-colors">
            <span class="text-neutral-500">-</span>
            <input type="number" name="price_max" placeholder="Max" value="{{ request.GET.price_max }}" class="w-full bg-neutral-900 border border-raum-border text-sm px-3 py-2 text-white focus:outline-none focus:border-white transition-colors">
          </div>
        </div>

        <!-- Brand -->
        {% if filter_options.brands %}
        <div class="border-b border-raum-border pb-6">
          <label class="block text-[10px] uppercase tracking-widest text-neutral-400 mb-3">Brand</label>
          <div class="space-y-2 max-h-40 overflow-y-auto">
            {% for brand in filter_options.brands %}
            <label class="flex items-center gap-2 cursor-pointer group">
              <input type="checkbox" name="brand" value="{{ brand }}" {% if brand in request.GET.getlist|default:'' %}checked{% endif %} class="w-4 h-4 bg-neutral-900 border border-raum-border checked:bg-white checked:border-white focus:outline-none">
              <span class="text-sm text-neutral-300 group-hover:text-white transition-colors">{{ brand }}</span>
            </label>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Material -->
        {% if filter_options.materials %}
        <div class="border-b border-raum-border pb-6">
          <label class="block text-[10px] uppercase tracking-widest text-neutral-400 mb-3">Material</label>
          <div class="space-y-2 max-h-40 overflow-y-auto">
            {% for material in filter_options.materials %}
            <label class="flex items-center gap-2 cursor-pointer group">
              <input type="checkbox" name="material" value="{{ material }}" {% if material in request.GET.getlist|default:'' %}checked{% endif %} class="w-4 h-4 bg-neutral-900 border border-raum-border checked:bg-white checked:border-white focus:outline-none">
              <span class="text-sm text-neutral-300 group-hover:text-white transition-colors">{{ material }}</span>
            </label>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Shape -->
        {% if filter_options.shapes %}
        <div class="border-b border-raum-border pb-6">
          <label class="block text-[10px] uppercase tracking-widest text-neutral-400 mb-3">Shape</label>
          <div class="space-y-2 max-h-40 overflow-y-auto">
            {% for shape in filter_options.shapes %}
            <label class="flex items-center gap-2 cursor-pointer group">
              <input type="checkbox" name="shape" value="{{ shape }}" {% if shape in request.GET.getlist|default:'' %}checked{% endif %} class="w-4 h-4 bg-neutral-900 border border-raum-border checked:bg-white checked:border-white focus:outline-none">
              <span class="text-sm text-neutral-300 group-hover:text-white transition-colors">{{ shape }}</span>
            </label>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Color -->
        {% if filter_options.colors %}
        <div class="border-b border-raum-border pb-6">
          <label class="block text-[10px] uppercase tracking-widest text-neutral-400 mb-3">Color</label>
          <div class="space-y-2 max-h-40 overflow-y-auto">
            {% for color in filter_options.colors %}
            <label class="flex items-center gap-2 cursor-pointer group">
              <input type="checkbox" name="color" value="{{ color }}" {% if color in request.GET.getlist|default:'' %}checked{% endif %} class="w-4 h-4 bg-neutral-900 border border-raum-border checked:bg-white checked:border-white focus:outline-none">
              <span class="text-sm text-neutral-300 group-hover:text-white transition-colors">{{ color }}</span>
            </label>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Reset Button -->
        <button
          type="button"
          hx-get="{% url 'catalog:product_list' %}{% if selected_category %}?category={{ selected_category.slug }}{% endif %}"
          hx-target="#product-grid"
          hx-swap="outerHTML"
          hx-push-url="true"
          class="w-full border border-raum-border text-sm uppercase tracking-widest py-3 hover:bg-white hover:text-black transition-all">
          Clear Filters
        </button>
      </form>
    </div>
  </div>

  <!-- Product Grid -->
  {% include 'catalog/partials/product_grid.html' %}
</div>
