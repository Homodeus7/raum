<div
  class="min-h-screen bg-raum-black"
  x-data="{ selectedSize: null, currentImageIndex: 0, images: {{ product.images.all|length }} }"
>
  <!-- Back Button -->
  <div class="px-4 md:px-8 py-4 border-b border-raum-border">
    <button
      hx-get="{% url 'catalog:product_list' %}"
      hx-target="#main-content"
      hx-swap="innerHTML show:top"
      hx-push-url="true"
      class="flex items-center space-x-2 text-neutral-400 hover:text-white transition-colors text-xs uppercase tracking-wider"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="m12 19-7-7 7-7" />
        <path d="M19 12H5" />
      </svg>
      <span>Back to Catalog</span>
    </button>
  </div>

  <!-- Product Detail Content -->
  <div class="flex flex-col lg:flex-row">
    <!-- Left: Image Gallery -->
    <div
      class="w-full lg:w-2/3 bg-neutral-800 relative group h-[500px] lg:h-screen"
    >
      {% if product.images.all %} {% for image in product.images.all %}
      <img
        x-show="currentImageIndex === {{ forloop.counter0 }}"
        src="{{ image.image.url }}"
        alt="{{ product.name }}"
        class="w-full h-full object-cover absolute inset-0"
        x-transition:enter="transition ease-in-out duration-500"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in-out duration-500"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
      />
      {% endfor %} {% endif %}

      <!-- Bottom gradient overlay for thumbnails visibility -->
      <div
        class="absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black/60 via-black/30 to-transparent pointer-events-none"
      ></div>

      <!-- Navigation Arrows -->
      {% if product.images.all|length > 1 %}
      <button
        @click="currentImageIndex = currentImageIndex > 0 ? currentImageIndex - 1 : {{ product.images.all|length|add:'-1' }}"
        class="absolute left-4 top-1/2 -translate-y-1/2 bg-black/80 hover:bg-black p-3 rounded-full opacity-0 group-hover:opacity-100 transition-all"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="white"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="m12 19-7-7 7-7" />
          <path d="M19 12H5" />
        </svg>
      </button>
      <button
        @click="currentImageIndex = currentImageIndex < {{ product.images.all|length|add:'-1' }} ? currentImageIndex + 1 : 0"
        class="absolute right-4 top-1/2 -translate-y-1/2 bg-black/80 hover:bg-black p-3 rounded-full opacity-0 group-hover:opacity-100 transition-all"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="white"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M5 12h14" />
          <path d="m12 5 7 7-7 7" />
        </svg>
      </button>

      <!-- Thumbnail Navigation -->
      <div
        class="absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2 z-10"
      >
        {% for image in product.images.all %}
        <button
          @click="currentImageIndex = {{ forloop.counter0 }}"
          :class="currentImageIndex === {{ forloop.counter0 }} ? 'ring-2 ring-white opacity-100' : 'opacity-50 hover:opacity-75'"
          class="w-16 h-16 rounded overflow-hidden transition-all"
        >
          <img
            src="{{ image.image.url }}"
            alt="{{ product.name }}"
            class="w-full h-full object-cover"
          />
        </button>
        {% endfor %}
      </div>
      {% endif %}
    </div>

    <!-- Right: Details & Purchase -->
    <div class="w-full lg:w-1/3 p-8 flex flex-col">
      <!-- Product Info -->
      <div class="mb-6">
        <h1 class="text-3xl uppercase font-bold mb-2 tracking-tighter">
          {{ product.name }}
        </h1>
        <p class="text-xl">${{ product.price }}</p>
      </div>

      <!-- Category -->
      <div class="text-xs text-neutral-500 uppercase mb-6">
        <span>{{ product.category.name }}</span>
        {% if product.brand %}
        <span class="ml-2">â€¢ {{ product.brand }}</span>
        {% endif %}
      </div>

      <!-- Description -->
      <div class="mb-6 text-sm text-neutral-300">
        <h3 class="text-[10px] uppercase text-neutral-500 mb-2 tracking-widest">
          Details
        </h3>
        <p>{{ product.description }}</p>
      </div>

      <!-- Characteristics -->
      {% if product.material or product.shape or product.lens_type %}
      <div class="mb-6 text-sm">
        <h3 class="text-[10px] uppercase text-neutral-500 mb-2 tracking-widest">
          Characteristics
        </h3>
        <div class="space-y-1 text-neutral-300">
          {% if product.material %}
          <p>
            <span class="text-neutral-500">Material:</span> {{ product.material
            }}
          </p>
          {% endif %} {% if product.shape %}
          <p>
            <span class="text-neutral-500">Shape:</span> {{ product.shape }}
          </p>
          {% endif %} {% if product.lens_type %}
          <p>
            <span class="text-neutral-500">Lens Type:</span> {{
            product.lens_type }}
          </p>
          {% endif %}
        </div>
      </div>
      {% endif %}

      <!-- Color Selection -->
      {% if product.color %}
      <div class="mb-6">
        <h3 class="text-[10px] uppercase text-neutral-500 mb-2 tracking-widest">
          Color: <span class="text-white">{{ product.color }}</span>
        </h3>
        <div class="w-6 h-6 border border-white bg-black cursor-pointer"></div>
      </div>
      {% endif %}

      <!-- Size Selection -->
      <div class="mb-8">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-[10px] uppercase text-neutral-500 tracking-widest">
            Select a size:
          </h3>
          <span class="text-[10px] underline text-neutral-500 cursor-pointer"
            >Size guide</span
          >
        </div>
        <div class="flex justify-between space-x-2">
          {% for size in available_sizes %}
          <button
            @click="selectedSize = '{{ size }}'"
            :class="selectedSize === '{{ size }}' ? 'border-white bg-white text-black' : 'border-transparent text-neutral-500'"
            class="h-8 flex-1 text-xs border hover:border-neutral-600 transition-colors"
          >
            {{ size }}
          </button>
          {% endfor %}
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="space-y-3 mt-auto">
        <button
          @click="if (selectedSize) {
            $refs.addToCartForm.querySelector('input[name=size]').value = selectedSize;
            htmx.trigger($refs.addToCartForm, 'submit');
          }"
          :disabled="!selectedSize"
          :class="selectedSize ? 'opacity-100' : 'opacity-50 cursor-not-allowed'"
          class="w-full bg-white text-black py-4 uppercase font-bold tracking-widest hover:bg-neutral-200 transition-colors"
        >
          <span x-text="selectedSize ? 'Add to Bag' : 'Select Size'"></span>
        </button>

        <form
          x-ref="addToCartForm"
          hx-post="{% url 'catalog:add_to_cart' product.id %}"
          hx-target="#cart-content"
          hx-swap="innerHTML"
          @htmx:after-request="cartOpen = true"
          style="display: none"
        >
          {% csrf_token %}
          <input type="hidden" name="size" value="" />
        </form>

        <button
          class="w-full border border-raum-border text-white py-4 uppercase font-bold tracking-widest hover:border-white transition-colors flex justify-center items-center space-x-2"
        >
          <span>Add to Wishlist</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"
            />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Related Products Section -->
  {% include "catalog/partials/related_products.html" %}
</div>
